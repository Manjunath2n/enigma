<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="favicon.png">
  <title>Enigma</title>
  <script src="dialog.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div id="loading-screen" class="loading-screen">
    <div class="loading-content">
      <div class="hud-logo">
        <div class="logo-text">ENIGMA</div>
      </div>

      <div class="loading-progress">
        <div class="progress-bar"></div>
      </div>
      <div class="progress-percent">0%</div>
    </div>
  </div>


  <div class="desktop-layout container">
    <header class="topbar">
      <h1>Enigma</h1>
      <div class="status-indicator">
        <span class="status-dot"></span> Connected
      </div>
    </header>

    <main class="main">

      <aside class="sidebar">
        <section id="signupSection" class="card">
          <h3>Create account</h3>
          <input id="displayName" placeholder="Display name" />
          <button id="createBtn">Create account</button>
          <hr/>
          <h4>Recover</h4>
          <input id="recoverPass" placeholder="Enter recovery passcode" />
          <button id="recoverBtn">Recover account</button>
        </section>

        <section id="myInfo" class="card" style="display:none;"></section>

        <section class="card">
          <h3>Contacts</h3>
          <div class="addRow">
            <input id="friendKey" placeholder="Friend public key" />
            <button id="addContactBtn">Add</button>
          </div>
          <div id="addResult" class="small"></div>
          <div id="contacts" class="contacts">(no contacts)</div>
        </section>
      </aside>


      <section class="chatArea card">
        <div class="chatHeaderRow">
          <div id="chatHeader"><b>Open a contact</b></div>
          <div>
            <button id="clearChatBtn" title="Delete this chat">Delete chat</button>
          </div>
        </div>
        <div id="chat" class="chatWindow">
          <div class="no-chat">Select a contact to start chatting</div>
        </div>
        <div class="composer">
          <input id="msgInput" placeholder="Message..." />
          <button id="sendBtn">Send</button>
        </div>
      </section>
    </main>


  </div>








  </div>

 <script src="/config.js"></script>
  <script type="module" src="app.js"></script>
  <script>

    document.documentElement.classList.add('hud-dark');
    document.documentElement.setAttribute('data-color-scheme', 'dark');


    (function(){
      const loadingScreen = document.getElementById('loading-screen');
      const progressBar = document.querySelector('.progress-bar');
      const progressPercent = document.querySelector('.progress-percent');
      const logoText = document.querySelector('.hud-logo .logo-text');
      const loadingProgress = document.querySelector('.loading-progress');

      if (!progressBar || !logoText || !loadingScreen || !progressPercent || !loadingProgress) return;

      progressBar.style.width = '0%';
      progressBar.style.transition = 'width 0.3s ease';
      logoText.style.opacity = '0';
      logoText.style.transform = 'scale(0.96)';
      progressPercent.style.opacity = '1';

      let currentProgress = 0;

    
      function loadToSixty() {
        const interval = setInterval(() => {
          if (currentProgress < 60) {
            currentProgress++;
            progressBar.style.width = currentProgress + '%';
            progressPercent.textContent = currentProgress + '%';
          } else {
            clearInterval(interval);
           
            setTimeout(loadToNinetyNine, 1000);
          }
        }, 20);
      }

      
      function loadToNinetyNine() {
        const interval = setInterval(() => {
          if (currentProgress < 99) {
            currentProgress++;
            progressBar.style.width = currentProgress + '%';
            progressPercent.textContent = currentProgress + '%';
          } else {
            clearInterval(interval);
            
            setTimeout(loadToHundred, 1000);
          }
        }, 15);
      }

     
      function loadToHundred() {
        currentProgress = 100;
        progressBar.style.width = '100%';
        progressPercent.textContent = '100%';

       
        setTimeout(() => {
          loadingProgress.style.transition = 'opacity 400ms ease';
          loadingProgress.style.opacity = '0';
          progressPercent.style.transition = 'opacity 400ms ease';
          progressPercent.style.opacity = '0';

         
          setTimeout(() => {
            logoText.style.transition = 'opacity 1500ms ease, transform 1500ms ease';
            logoText.style.opacity = '1';
            logoText.style.transform = 'scale(1)';

            
            setTimeout(() => {
              loadingScreen.style.transition = 'opacity 600ms ease, visibility 600ms';
              loadingScreen.style.opacity = '0';
              loadingScreen.style.visibility = 'hidden';

              setTimeout(() => { 
                try { loadingScreen.remove(); } catch(e) {} 
              }, 700);
            }, 2000);
          }, 500);
        }, 300);
      }

     
      loadToSixty();
    })();


    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.mobile-screen').forEach(s => s.classList.remove('active'));
        const target = btn.dataset.target;
        if (document.getElementById(target)) document.getElementById(target).classList.add('active');
      });
    });
  </script>
</body>
</html>